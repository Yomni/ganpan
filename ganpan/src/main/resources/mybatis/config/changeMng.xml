<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper

PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"

"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- MyBatis에서 namespace는 필수적으로 명시해야 함 -->

 <mapper namespace="changeMng">
   
   <resultMap id="changeMngRM" type="changeMngVO">
		<result property="changeMngNo" column="change_management_no"/>
		<result property="changeWorker" column="change_worker"/>
		<result property="changeMngDate" column="change_management_DATE"/>
		<result property="boardNo" column="board_no"/>
		<result property="workVO.workNo" column="work_no"/>
		<result property="changeGenreVO.changeNo" column="change_no"/>
   </resultMap>
   
   <insert id="insertLogForCreateWork" parameterType="workVO">
   		insert into CHANGE_MANAGEMENT(change_management_no
   			,change_worker
   			,change_management_date
   			,work_no
   			,change_no)
		values(seq_change_management_no.nextval
			,#{organizationVO.workerMemberVO.nickName}
			,sysdate
			,#{workNo}
			,0)
   </insert>
   <!-- 
	   	INSERT INTO CHANGE_GENRE VALUES(0, '추가');
		INSERT INTO CHANGE_GENRE VALUES(1, '수정');
		INSERT INTO CHANGE_GENRE VALUES(2, '삭제');
		INSERT INTO CHANGE_GENRE VALUES(3, '이동');
	-->
   <insert id="insertLogForDeleteWork" parameterType="int">
   		insert into CHANGE_MANAGEMENT(change_management_no
   			,change_worker
   			,change_management_date
   			,work_no
   			,board_no
   			,change_no)
		values(seq_change_management_no.nextval
			,(SELECT worker_nickname as change_worker from work where work_no = #{value})
			,sysdate
			,#{value}
			,(SELECT board_no from work where work_no = #{value})
			,2)
   </insert>
   
   <insert id="insertLogForMoveWork" parameterType="int">
   		insert into CHANGE_MANAGEMENT(change_management_no
   			,change_worker
   			,change_management_date
   			,work_no
   			,board_no
   			,change_no)
		values(seq_change_management_no.nextval
			,(SELECT worker_nickname as change_worker from work where work_no = #{value})
			,sysdate
			,#{value}
			,(SELECT board_no from work where work_no = #{value})
			,3)
   </insert>
   
   <insert id="insertLogForCreateWorkByMove" parameterType="int">
   		insert into CHANGE_MANAGEMENT(change_management_no,change_worker
   			,change_management_date
   			,work_no
   			,board_no
   			,change_no)
		values(seq_change_management_no.nextval
			,(SELECT worker_nickname as change_worker from work where work_no = #{value})
			,sysdate
			,#{value}
			,(SELECT board_no from work where work_no = #{value})
			,0)
   </insert>
   
   <insert id="insertLogForUpdateWork" parameterType="workVO">
   		insert into CHANGE_MANAGEMENT(change_management_no,change_worker,change_management_date,board_no,work_no,change_no)
		values(seq_change_management_no.nextval,#{organizationVO.workerMemberVO.nickName},sysdate,#{boardNo},#{workNo},1)
   </insert>
   
   <select id="showChangeMngList" resultMap="changeMngRM">
		select c.change_management_no, c.change_worker, c.change_management_date, c.board_no, c.work_no, c.change_no
		from change_management c, work w
		where w.sign_board_name=#{svo.signBoardName} and w.boss_nickname=#{svo.bossMemberVO.nickName} and c.board_no=#{boardNo} and c.work_no=w.work_no
   </select>
   
   <select id="showTotalChangeMngList" resultMap="changeMngRM">
   		select c.change_management_no, c.change_worker, c.change_management_date, c.board_no, c.work_no, c.change_no
		from change_management c, work w
		where w.sign_board_name=#{svo.signBoardName} and w.boss_nickname=#{svo.bossMemberVO.nickName} and c.work_no=w.work_no
   </select>
   
   
   
</mapper>
